{% extends "base.html" %}

{% block title %}Add Field Maintenance - FS25 Farm Manager{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-10 mx-auto">
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-tools"></i> Record Field Maintenance</h3>
                <p class="mb-0 text-muted">
                    For Field: <strong>{{ field.field_name }}</strong> ({{ field.field_id }}) - {{ field.size_hectares }} ha
                </p>
            </div>
            <div class="card-body">
                <form method="POST">
                    <!-- Basic Information -->
                    <h5 class="mb-3">Maintenance Details</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="maintenance_date" class="form-label">Maintenance Date *</label>
                                <input type="date" class="form-control" id="maintenance_date" 
                                       name="maintenance_date" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="maintenance_type" class="form-label">Maintenance Type *</label>
                                <select class="form-select" id="maintenance_type" name="maintenance_type" required>
                                    <option value="">Select type</option>
                                    <option value="Plowing">Plowing</option>
                                    <option value="Cultivating">Cultivating</option>
                                    <option value="Weeding">Weeding</option>
                                    <option value="Fertilizing">Fertilizing</option>
                                    <option value="Liming">Liming</option>
                                    <option value="Spraying">Spraying (Pesticide/Herbicide)</option>
                                    <option value="Irrigation">Irrigation</option>
                                    <option value="Rolling">Rolling</option>
                                    <option value="Mulching">Mulching</option>
                                    <option value="Mowing">Mowing</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Optional Planting Association -->
                    {% if active_plantings %}
                    <div class="mb-3">
                        <label for="planting_id" class="form-label">
                            <i class="fas fa-seedling"></i> Associated Planting (Optional)
                        </label>
                        <select class="form-select" id="planting_id" name="planting_id">
                            <option value="">Not associated with specific planting</option>
                            {% for planting in active_plantings %}
                            <option value="{{ planting.planting_id }}">
                                {{ planting.crop_type }} 
                                {% if planting.variety %}({{ planting.variety }}){% endif %}
                                - Planted {{ planting.planting_date }}
                            </option>
                            {% endfor %}
                        </select>
                        <div class="form-text">Select if this maintenance is for a specific crop</div>
                    </div>
                    {% endif %}

                    <div class="mb-3">
                        <label for="operation_details" class="form-label">Operation Details</label>
                        <textarea class="form-control" id="operation_details" name="operation_details" 
                                  rows="2" placeholder="Describe what was done..."></textarea>
                    </div>

                    <!-- Equipment and Labor -->
                    <h5 class="mb-3 mt-4">Equipment & Labor</h5>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="equipment_used" class="form-label">Equipment Used</label>
                                <input type="text" class="form-control" id="equipment_used" 
                                       name="equipment_used" placeholder="e.g., John Deere 6M">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="operator_name" class="form-label">Operator</label>
                                <input type="text" class="form-control" id="operator_name" 
                                       name="operator_name" placeholder="Person who operated">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="hours_worked" class="form-label">Hours Worked</label>
                                <input type="number" step="0.1" min="0" class="form-control" 
                                       id="hours_worked" name="hours_worked" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- Costs -->
                    <h5 class="mb-3 mt-4">Costs</h5>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="labor_cost" class="form-label">Labor Cost ($)</label>
                                <input type="number" step="0.01" min="0" class="form-control" 
                                       id="labor_cost" name="labor_cost" value="0" onchange="calculateTotal()">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="equipment_cost" class="form-label">Equipment Cost ($)</label>
                                <input type="number" step="0.01" min="0" class="form-control" 
                                       id="equipment_cost" name="equipment_cost" value="0" onchange="calculateTotal()">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="material_cost" class="form-label">Material Cost ($)</label>
                                <input type="number" step="0.01" min="0" class="form-control" 
                                       id="material_cost" name="material_cost" value="0" onchange="calculateTotal()">
                                <div class="form-text">Fertilizer, chemicals, etc.</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="fuel_cost" class="form-label">Fuel Cost ($)</label>
                                <input type="number" step="0.01" min="0" class="form-control" 
                                       id="fuel_cost" name="fuel_cost" value="0" onchange="calculateTotal()">
                            </div>
                        </div>
                    </div>

                    <!-- Cost Summary -->
                    <div class="alert alert-info">
                        <h5>Total Maintenance Cost: $<span id="total-cost">0.00</span></h5>
                    </div>

                    <!-- Application Details -->
                    <h5 class="mb-3 mt-4">Application Details</h5>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="area_covered_ha" class="form-label">Area Covered (ha)</label>
                                <input type="number" step="0.1" min="0" class="form-control" 
                                       id="area_covered_ha" name="area_covered_ha" 
                                       value="{{ field.size_hectares }}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="product_used" class="form-label">Product Used</label>
                                <input type="text" class="form-control" id="product_used" 
                                       name="product_used" placeholder="e.g., Round-Up, Urea">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="application_rate" class="form-label">Application Rate</label>
                                <input type="text" class="form-control" id="application_rate" 
                                       name="application_rate" placeholder="e.g., 200 kg/ha">
                            </div>
                        </div>
                    </div>

                    <!-- Conditions -->
                    <h5 class="mb-3 mt-4">Field Conditions</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="weather_conditions" class="form-label">Weather Conditions</label>
                                <input type="text" class="form-control" id="weather_conditions" 
                                       name="weather_conditions" placeholder="e.g., Sunny, 22°C, Light breeze">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="soil_conditions" class="form-label">Soil Conditions</label>
                                <select class="form-select" id="soil_conditions" name="soil_conditions">
                                    <option value="">Select condition</option>
                                    <option value="Dry">Dry</option>
                                    <option value="Adequate">Adequate</option>
                                    <option value="Wet">Wet</option>
                                    <option value="Saturated">Saturated</option>
                                    <option value="Frozen">Frozen</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="notes" class="form-label">Additional Notes</label>
                        <textarea class="form-control" id="notes" name="notes" rows="3" 
                                  placeholder="Any observations, issues, or recommendations..."></textarea>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Save Maintenance Record
                        </button>
                        <a href="{{ url_for('field_detail', field_id=field.field_id) }}" 
                           class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Field
                        </a>
                        <a href="{{ url_for('fields_list') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-list"></i> Back to Fields List
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Quick Reference Card -->
        <div class="card mt-3">
            <div class="card-header">
                <h5><i class="fas fa-info-circle"></i> Maintenance Type Guide</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Common Operations:</h6>
                        <ul class="small">
                            <li><strong>Plowing:</strong> Primary tillage, turning soil</li>
                            <li><strong>Cultivating:</strong> Secondary tillage, preparing seedbed</li>
                            <li><strong>Weeding:</strong> Mechanical or manual weed removal</li>
                            <li><strong>Fertilizing:</strong> Applying nutrients (N-P-K)</li>
                            <li><strong>Liming:</strong> Adjusting soil pH</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Application Operations:</h6>
                        <ul class="small">
                            <li><strong>Spraying:</strong> Herbicides, pesticides, fungicides</li>
                            <li><strong>Irrigation:</strong> Water application</li>
                            <li><strong>Rolling:</strong> Soil compaction, leveling</li>
                            <li><strong>Mulching:</strong> Applying organic matter</li>
                            <li><strong>Mowing:</strong> Cutting grass or vegetation</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function calculateTotal() {
    const labor = parseFloat(document.getElementById('labor_cost').value) || 0;
    const equipment = parseFloat(document.getElementById('equipment_cost').value) || 0;
    const material = parseFloat(document.getElementById('material_cost').value) || 0;
    const fuel = parseFloat(document.getElementById('fuel_cost').value) || 0;
    
    const total = labor + equipment + material + fuel;
    document.getElementById('total-cost').textContent = total.toFixed(2);
}

// Set today's date as default
document.getElementById('maintenance_date').valueAsDate = new Date();

// Initialize
calculateTotal();
</script>
{% endblock %}